# Lenovo-M710q-Mojave
## 第一次折腾小主机，主要实现QTJ2在如此小的供电和散热环境下性能释放以及问题记录
+ Catalina经过尝试也是可以的，所以理论上可以直接升级，Bugsur没尝试。
+ Windows11经过尝试也是可以进入的，我是直接使用Windows11的SSD接入可以直接进入系统，没有尝试安装Windows。
+ M710q魔改的QTJ2，魔改BIOS解锁了温度墙，电流墙以及功耗墙，我是用130W的电源，因为烤鸡最高到了110W，90W肯定带不动（我尝试用45W电源可以点亮，但是近不去系统）。
+ 整机待机在15W左右，日常使用在15W～60W之间，目前使用35W单热管散热，高负载时风扇会4000RPM往上，差不多开飞机，正常写代码使用docker风扇基本800～2000RPM，温度40～60度，比较安静。 
+ 整体来说，这个平台已经将QTJ2发挥了95%以上性能了。仅供参考，修改BIOS和超频有风险，如果在操作中造成物理损害或者点不亮概不负责。
+ EFI中三码需要重新生成。

### 平台配置 Mojave10.14.6 (OC 0.7.8) 
```
CPU QTJ2(6c12T)
主机 Lenovo-M710q
内存 三星 16G（3200-CL18）* 2
显卡 核显UHD 630
网卡 博通BCM94360CS
SSD PLEXTOR PX-256M7VG 256GB(SATA协议)
```

### 关于BIOS设置（很重要）
+ 为了使这个平台充分发挥QTJ2的性能，调试如下（根据个人CPU，内存体质不同个别设置稍有不同，不可照搬，造成物理损害点不亮概不负责）
+ F9恢复默认设置
+ 关闭CMS，不然进不了黑苹果。
+ 关闭C1E
+ 解锁功耗墙设置【高级菜单】-【Power & Performance】-【CPU - Power Management Control】-【Config TDP Configurations】
将【Nominal】中的 Power Limit 1修改为65000（65w）和 Power Limit 2修改为85000（85w） Power Limit 1 Time Window修改为38。
+ 解锁电流墙设置【高级菜单】-【Power & Performance】-【CPU - Power Management Control】-【CPU VR Settings】-【Core/IA VR Settings】将【VR Current Limit】改为最高允许通过的核心电流，建议填 400（即 100A）
+ 解锁温度墙设置 【高级菜单】-【Thermal Configuration】-【CPU Thermal Configuration】将【Bi-directional PROCHOT#】设置为【关闭】即可。
+ CPU降压超频，QTJ2是不支持超频的，但是可以打开OC降电压。这个对性能和温度影响比较大，只需要将电压降至一个可稳定的值，发热可以降低10度以上，这样性能同样还可以提升许多，我尝试降压和不降俩种跑分，差距有20%之多。我这个CPU体质可以-178，设置-180可以进系统，但是偶尔会死机，所以-178是我探索的完美电压。
+ 内存默认最高只能上到2933，我的内存是3200默认给不上去，即使bios设置到3200档位，但是进入系统还是2933，不知道是什么原因。只能超频到3200，但是魔改bios超频内存后CL值默认最高18，还好我的内存体质还可以，不用调高电压也能上去，但是偶尔会死机，调高电压也一样，后调高REFI至65535稳定。其他时序（RCD，RP，RAS，RFC等）都不能动，-1都不行，直接三长一短点不亮，不知道有啥讲究，我只能怀疑是魔改bios的问题。现在开机偶尔会三长一短，关机重启又能点亮并且还是超频的设置。不懂。
+ 现在内存超频设置是频率133*12，REFI设置65535，保持稳定使用。
+ 内存调试需要拿掉BIOS电池，这样如果不亮机可以断电再插上，内存即可恢复默认并点亮。
+ CPU倍频不要设置【高级菜单】-【Power & Performance】-【CPU - Power Management Control】-【View/Configure Turbo Options】都默认0即可。我尝试设置了之后默认倍频可能会变成最高28不能上调，进入系统CPU也运行在2.8G最高。这个感觉是Bug，需要进入到倍频设置界面按F9恢复最初设置默认设置为0即可。
+ 以上是我针对当前的魔改BIOS的一些探索和经验，使其能发挥到更好的性能和温度。

### 关于温度墙
+ 对于这台机器最大的其实不是供电问题，是因为mos管本来就有一个空位，导致在高负载时CPU附近的俩个mos管温度超高，压力巨大，CPU会连续降频2.5G。
+ 降频性能R23跑分大概在7100左右，中间会因为温度连续降频几秒钟，但是CPU温度也就80多度，理论上这个温度是不会撞到CPU的温度墙，我测试把我的玄冰400压在CPU上，跑R23使CPU满载找主板的热区（没有热感应枪，用手摸的，大家别模仿），摸到mos管使把我手都烫红了。
+ 我尝试拿吹风机在跑r23时对着mos管吹凉到65度以下，CPU不会降频稳定全核4G，跑分也能正常到8000多，所以判定主板热区就是mos管。只要解决mos管的散热，基本就能解决这个平台温度墙的问题。
+ 不过只要不重度使用（使CPU连续满载超过2分钟），这个温度墙是不会影响当前平台性能的。当然我现在还没有解决，这个地方压上散热器后地方太小了，容不下什么散热片或者小风扇，我看到有65W版本的双热管散热器，对mos管附近也有贴片支持散热（单热管没有），不知道效果如何，如果有机会我再进行替换尝试。

### 显卡驱动
+ 4K+2K双输出稳定不闪屏，这个需要关注的是关于内存通道，如果是使用单通道内存，对4K和整机性能会有10%+的性能损失(使用低于2K单屏幕影响小很多)，我之前以为是主板供电影响，后面使用俩条内存双通道之后，性能直接上去一个台阶（之前geekbench单核1050，多核4400，双通道之后单核1050，多核6200），使用体验上也流畅了很多。使用Launchpad也流畅了许多（单通道内存Launchpad就是幻灯片）所以总结，高分辨率双通道内存对这个平台很重要。不管是核显，还是日常操作。
```
AAPL,ig-platform-id 07009B3E 
device-id 9B3E0000 
```

### 声卡驱动
```
layout-id 12
```

### 网卡驱动
+ 免驱网卡
